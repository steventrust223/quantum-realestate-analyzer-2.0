<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Quantum Real Estate Analyzer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        .nav-header {
            background: white;
            padding: 15px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-header h1 { color: #667eea; font-size: 1.5em; }
        .back-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
        }
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card h2 span { font-size: 1.2em; }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        .btn:hover { opacity: 0.9; }
        .btn-secondary { background: #6c757d; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: #667eea;
            outline: none;
        }
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 12px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } }
        .setting-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .setting-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1em;
        }
        .toggle-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .toggle-info h4 { color: #333; margin-bottom: 5px; }
        .toggle-info p { font-size: 12px; color: #666; }
        .switch {
            position: relative;
            width: 50px;
            height: 26px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 26px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        input:checked + .slider { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        input:checked + .slider:before { transform: translateX(24px); }
        .danger-zone {
            border: 2px solid #dc3545;
            padding: 20px;
            border-radius: 10px;
            background: #fff5f5;
        }
        .danger-zone h3 {
            color: #dc3545;
            margin-bottom: 15px;
        }
        .pipeline-editor {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .pipeline-editor h4 {
            margin-bottom: 10px;
            color: #333;
        }
        .stage-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .stage-item {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .stage-item .remove {
            cursor: pointer;
            font-weight: bold;
        }
        .api-key {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .api-key input {
            flex: 1;
            font-family: monospace;
        }
        .integration-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .integration-info { display: flex; align-items: center; gap: 15px; }
        .integration-icon { font-size: 2em; }
        .integration-name { font-weight: 600; color: #333; }
        .integration-status { font-size: 12px; color: #666; }
        .status-connected { color: #4caf50; }
        .status-disconnected { color: #999; }
        .version-info {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-header">
            <h1>Settings</h1>
            <a href="control-center.html" class="back-btn">Back to Control Center</a>
        </div>

        <!-- General Settings -->
        <div class="card">
            <h2><span>&#9881;</span> General Settings</h2>
            <form id="generalSettingsForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" name="companyName" id="companyName" placeholder="Your Company Name">
                    </div>
                    <div class="form-group">
                        <label>Default Currency</label>
                        <select name="currency" id="currency">
                            <option value="USD">USD ($)</option>
                            <option value="CAD">CAD ($)</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date Format</label>
                        <select name="dateFormat" id="dateFormat">
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Timezone</label>
                        <select name="timezone" id="timezone">
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            <option value="America/Phoenix">Arizona Time</option>
                            <option value="Pacific/Honolulu">Hawaii Time</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Theme</label>
                    <select name="theme" id="theme">
                        <option value="light">Light Mode</option>
                        <option value="dark">Dark Mode (Coming Soon)</option>
                    </select>
                </div>
                <button type="submit" class="btn">Save General Settings</button>
            </form>
        </div>

        <!-- Pipeline Settings -->
        <div class="card">
            <h2><span>&#128202;</span> Pipeline Configuration</h2>
            <p style="color: #666; margin-bottom: 20px;">Customize deal pipeline stages for your workflow.</p>

            <div class="pipeline-editor">
                <h4>Wholesaling Pipeline</h4>
                <div class="stage-list" id="wholesalingStages">
                    <!-- Stages loaded dynamically -->
                </div>
            </div>

            <div class="pipeline-editor">
                <h4>Sub2 Pipeline</h4>
                <div class="stage-list" id="sub2Stages">
                    <!-- Stages loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Notifications -->
        <div class="card">
            <h2><span>&#128276;</span> Notification Settings</h2>

            <div class="toggle-switch">
                <div class="toggle-info">
                    <h4>Email Notifications</h4>
                    <p>Receive email alerts for new leads and deal updates</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="emailNotifications" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="toggle-switch">
                <div class="toggle-info">
                    <h4>Deal Status Alerts</h4>
                    <p>Get notified when deals move between pipeline stages</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="dealAlerts" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="toggle-switch">
                <div class="toggle-info">
                    <h4>Task Reminders</h4>
                    <p>Receive reminders for upcoming and overdue tasks</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="taskReminders" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="toggle-switch">
                <div class="toggle-info">
                    <h4>Weekly Reports</h4>
                    <p>Get weekly summary reports via email</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="weeklyReports">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Integrations -->
        <div class="card">
            <h2><span>&#128279;</span> Integrations</h2>
            <p style="color: #666; margin-bottom: 20px;">Connect external services to enhance functionality.</p>

            <div class="integration-card">
                <div class="integration-info">
                    <div class="integration-icon">&#128231;</div>
                    <div>
                        <div class="integration-name">Email Service (SMTP)</div>
                        <div class="integration-status status-disconnected">Not configured</div>
                    </div>
                </div>
                <button class="btn btn-secondary btn-sm" style="padding: 8px 15px;">Configure</button>
            </div>

            <div class="integration-card">
                <div class="integration-info">
                    <div class="integration-icon">&#128202;</div>
                    <div>
                        <div class="integration-name">Google Analytics</div>
                        <div class="integration-status status-disconnected">Not connected</div>
                    </div>
                </div>
                <button class="btn btn-secondary btn-sm" style="padding: 8px 15px;">Connect</button>
            </div>

            <div class="integration-card">
                <div class="integration-info">
                    <div class="integration-icon">&#128176;</div>
                    <div>
                        <div class="integration-name">Plaid (Banking)</div>
                        <div class="integration-status status-disconnected">Not connected</div>
                    </div>
                </div>
                <button class="btn btn-secondary btn-sm" style="padding: 8px 15px;">Connect</button>
            </div>

            <div class="integration-card">
                <div class="integration-info">
                    <div class="integration-icon">&#128221;</div>
                    <div>
                        <div class="integration-name">DocuSign</div>
                        <div class="integration-status status-disconnected">Not connected</div>
                    </div>
                </div>
                <button class="btn btn-secondary btn-sm" style="padding: 8px 15px;">Connect</button>
            </div>
        </div>

        <!-- API Settings -->
        <div class="card">
            <h2><span>&#128272;</span> API Configuration</h2>
            <p style="color: #666; margin-bottom: 20px;">Manage API access for third-party integrations.</p>

            <div class="form-group">
                <label>API Key</label>
                <div class="api-key">
                    <input type="password" id="apiKey" value="qra_xxxxxxxxxxxxxxxxxxxx" readonly>
                    <button type="button" class="btn btn-secondary" onclick="toggleApiKey()">Show</button>
                    <button type="button" class="btn" onclick="regenerateApiKey()">Regenerate</button>
                </div>
                <small>Use this key to authenticate API requests from external applications.</small>
            </div>

            <div class="form-group">
                <label>API Base URL</label>
                <input type="text" value="http://localhost:3000/api" readonly style="background: #f8f9fa;">
            </div>
        </div>

        <!-- Data Management -->
        <div class="card">
            <h2><span>&#128190;</span> Data Management</h2>

            <div class="setting-section">
                <h3>Export Data</h3>
                <p style="color: #666; margin-bottom: 15px;">Download all your data in JSON format for backup or migration.</p>
                <button class="btn btn-secondary" onclick="exportAllData()">Export All Data</button>
            </div>

            <div class="danger-zone">
                <h3>Danger Zone</h3>
                <p style="color: #666; margin-bottom: 15px;">These actions are irreversible. Please proceed with caution.</p>
                <button class="btn btn-danger" onclick="confirmReset()">Reset All Data</button>
            </div>
        </div>

        <!-- Version Info -->
        <div class="version-info">
            <p><strong>Quantum Real Estate Analyzer</strong></p>
            <p>Version 2.0.0</p>
            <p>Built with precision for real estate professionals</p>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        async function loadSettings() {
            try {
                const [settingsRes, companyRes] = await Promise.all([
                    fetch(`${API_BASE}/settings`),
                    fetch(`${API_BASE}/company`)
                ]);

                const settings = await settingsRes.json();
                const company = await companyRes.json();

                if (settings.success) {
                    const s = settings.data.general || {};
                    if (s.companyName) document.getElementById('companyName').value = s.companyName;
                    if (s.currency) document.getElementById('currency').value = s.currency;
                    if (s.dateFormat) document.getElementById('dateFormat').value = s.dateFormat;
                    if (s.timezone) document.getElementById('timezone').value = s.timezone;
                    if (s.theme) document.getElementById('theme').value = s.theme;
                }

                if (company.success && company.data.settings) {
                    const cs = company.data.settings;
                    if (cs.pipelineStages) {
                        renderPipelineStages('wholesalingStages', cs.pipelineStages.wholesaling || []);
                        renderPipelineStages('sub2Stages', cs.pipelineStages.sub2 || []);
                    }
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function renderPipelineStages(containerId, stages) {
            const container = document.getElementById(containerId);
            container.innerHTML = stages.map(stage => `
                <div class="stage-item">
                    ${stage}
                </div>
            `).join('');
        }

        document.getElementById('generalSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const general = Object.fromEntries(formData);

            try {
                const response = await fetch(`${API_BASE}/settings`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ general })
                });
                const result = await response.json();
                if (result.success) {
                    alert('Settings saved successfully!');
                }
            } catch (error) {
                alert('Error saving settings: ' + error.message);
            }
        });

        function toggleApiKey() {
            const input = document.getElementById('apiKey');
            const btn = event.target;
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'Hide';
            } else {
                input.type = 'password';
                btn.textContent = 'Show';
            }
        }

        function regenerateApiKey() {
            if (confirm('Are you sure you want to regenerate your API key? Existing integrations will stop working.')) {
                const newKey = 'qra_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                document.getElementById('apiKey').value = newKey;
                alert('New API key generated. Make sure to update your integrations.');
            }
        }

        async function exportAllData() {
            try {
                const endpoints = ['deals', 'buyers', 'sellers', 'properties', 'team', 'company'];
                const data = {};

                for (const endpoint of endpoints) {
                    const response = await fetch(`${API_BASE}/${endpoint}`);
                    const result = await response.json();
                    if (result.success) {
                        data[endpoint] = result.data;
                    }
                }

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `quantum-rea-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('Error exporting data: ' + error.message);
            }
        }

        function confirmReset() {
            if (confirm('WARNING: This will permanently delete ALL your data. This action cannot be undone. Are you absolutely sure?')) {
                if (confirm('Final confirmation: Type "DELETE" in the next prompt to confirm.')) {
                    const input = prompt('Type DELETE to confirm:');
                    if (input === 'DELETE') {
                        alert('Data reset functionality would go here. For safety, this is disabled in the demo.');
                    }
                }
            }
        }

        loadSettings();
    </script>
</body>
</html>
